from google.appengine.ext.db import Errorfrom bottle import Bottle, request, template, redirectfrom src.controller.user import UserControllerfrom src.controller.role import RoleControllerfrom lib.util import toClassapp = Bottle()@app.post("/all")def users():	rsUsers = UserController.getUsers()	dUsers = dict([('page',1), ('rows',[rUser.toCells(["uname", "role"]) for rUser in rsUsers])])	dUsers.update(total=len(dUsers['rows']))	return dUsers@app.route("/view/<id>")def view_user(id):	try:		rsRoles = RoleController.getRoles()		rsUser = UserController.getUser(int(id))		dUser = rsUser.toRow()		dUser.update([('roles',[rRole.toRows(['name']) for rRole in rsRoles])])		return dUser	except TypeError:		return None@app.route("/roles")def user_roles():	rsRoles = RoleController.getRoles()	return {"roles":[rRole.toRows(["name"]) for rRole in rsRoles]}@app.post("/update")def update_user():	if UserController.updateUser(toClass(request.forms.dict)):		return {"success": True}	else:		return {"success": False}@app.post("/add")def add_user():	if UserController.addUser(toClass(request.forms.dict)):		return {"success": True}	else:		return {"success": False}@app.delete("/delete/<id>")def delete_user(id):	if UserController.deleteUser(id):		return {"success": True}	else:		return {"success": False}			